<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <title>SIREP 2.0</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
<header>
  <div class="top">
    <h1>SIREP 2.0</h1>
    <div class="icons">
      <div class="icon" title="Configurações" aria-label="Configurações">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2"><path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V22a2 2 0 1 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H2a2 2 0 1 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06A2 2 0 1 1 6.04 2.4l.06.06a1.65 1.65 0 0 0 1.82.33H8a1.65 1.65 0 0 0 1-1.51V2a2 2 0 1 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V8c0 .66.26 1.3.73 1.77.47.47 1.11.73 1.77.73H22a2 2 0 1 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
      </div>
      <div class="icon" title="Conta" aria-label="Conta">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2"><path d="M20 21a8 8 0 1 0-16 0"/><circle cx="12" cy="7" r="4"/></svg>
      </div>
    </div>
  </div>
</header>

<main>
  <div class="card">
    <div class="tabs">
      <div class="tab active" data-tab="gestao">Gestão da Base</div>
      <div class="tab" data-tab="tratamento">Tratamento</div>
    </div>
    <div class="content">
      <section id="tab-gestao">
        <div class="grid">
          <div>
            <div class="row" style="margin-bottom:10px;">
              <div class="controls">
                <button id="btnIniciar" class="primary">Iniciar</button>
                <button id="btnPausar">Pausar</button>
                <button id="btnContinuar" disabled>Continuar</button>
              </div>
            </div>
            <div class="muted">Estado: <span id="estadoTexto">Ocioso</span></div>
            <div class="progress-row">
              <div class="progress" title="Progresso total"><div id="barTotal" style="width:0%"></div></div>
              <div class="progress-info">
                <span id="lblTotal" class="muted">0% concluído</span>
                <span class="muted" id="ultimaAtualizacao">Última atualização: —</span>
              </div>
            </div>

            <div class="subtabs">
              <span class="subtab active" id="subtabPlanos">Planos capturados</span>
              <span class="subtab" id="subtabOcorr">Ocorrências <span class="badge" id="badgeOcorr">0</span></span>
            </div>

            <!-- Tabela Planos -->
            <div id="wrapPlanos">
              <div style="overflow:auto">
                <table>
                  <thead><tr>
                    <th scope="col">CARTEIRA</th>
                    <th scope="col">CNPJ</th>
                    <th class="filterable" scope="col">
                      <div class="th-filter no-toggle">
                        <div class="th-filter-label">
                          <span>SITUAÇÃO</span>
                        </div>
                      </div>
                    </th>
                    <th scope="col">TIPO</th>
                    <th class="right" scope="col">DIAS EM ATRASO</th>
                    <th class="right" scope="col">SALDO</th>
                    <th scope="col">DT SITUAÇÃO</th>
                  </tr></thead>
                  <tbody id="tbody"></tbody>
                </table>
              </div>
              <div class="footer">
                <div class="muted" id="footerInfo">nada a exibir por aqui.</div>
                <div>
                  <button id="btnAnterior" aria-label="Página anterior" title="Página anterior">&lt;</button>
                  <span class="muted" id="lblPaginaTotal" style="margin:0 6px">pág. 1 de 1</span>
                  <button id="btnProximo" aria-label="Próxima página" title="Próxima página">&gt;</button>
                </div>
              </div>
            </div>

            <!-- Tabela Ocorrências -->
            <div id="wrapOcorr" style="display:none">
              <div style="overflow:auto">
                <table>
                  <thead><tr>
                    <th>CARTEIRA</th>
                    <th class="filterable" scope="col">
                      <div class="th-filter" id="filtroOcorrTrigger">
                        <div class="th-filter-label">
                          <span>SITUAÇÃO</span>
                        </div>
                        <button type="button" class="filter-toggle" id="filtroOcorrToggle" aria-haspopup="true" aria-expanded="false" aria-controls="filtroOcorrMenu" aria-label="Filtrar ocorrências por situação" title="Filtrar ocorrências por situação">
                          <svg width="12" height="12" viewBox="0 0 12 12" aria-hidden="true"><path d="M3 4.5 6 7.5l3-3" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        </button>
                      </div>
                    </th>
                    <th>CNPJ</th><th>TIPO</th><th class="right">SALDO</th><th>DT SITUAÇÃO</th>
                  </tr></thead>
                  <tbody id="tbodyOcc"></tbody>
                </table>
              </div>
              <div class="filter-menu" id="filtroOcorrMenu" role="menu" aria-labelledby="filtroOcorrTrigger">
                <button type="button" class="filter-option active" data-value="TODAS" role="menuitemradio" aria-checked="true">Todas</button>
                <button type="button" class="filter-option" data-value="SIT ESPECIAL" role="menuitemradio" aria-checked="false">Sit especial</button>
                <button type="button" class="filter-option" data-value="LIQUIDADO" role="menuitemradio" aria-checked="false">Liquidado</button>
                <button type="button" class="filter-option" data-value="RESCINDIDO" role="menuitemradio" aria-checked="false">Rescindido</button>
                <button type="button" class="filter-option" data-value="GRDE Emitida" role="menuitemradio" aria-checked="false">GRDE emitida</button>
              </div>
              <div class="footer">
                <div class="muted" id="footerInfoOcc">nada a exibir por aqui.</div>
                <div>
                  <button id="btnAnteriorOcc" aria-label="Página anterior" title="Página anterior">&lt;</button>
                  <span class="muted" id="lblPaginaTotalOcc" style="margin:0 6px">pág. 1 de 1</span>
                  <button id="btnProximoOcc" aria-label="Próxima página" title="Próxima página">&gt;</button>
                </div>
              </div>
            </div>

            <!-- Card de Eventos (logs) -->
            <div id="cardLogs" class="card logs-card" aria-live="polite">
              <div class="logs-header" id="logsHeader" role="button" tabindex="0" aria-expanded="false" aria-controls="logsBody" title="Mostrar/ocultar janela de eventos (logs)">
                <div class="logs-title">
                  <span class="caret" aria-hidden="true">▶</span>
                  <strong>Janela de Eventos (logs)</strong>
                </div>

                <div class="logs-actions">
                  <label class="muted" for="logsFrom">De:</label>
                  <input type="date" id="logsFrom" aria-label="Data inicial" />
                  <label class="muted" for="logsTo">Até:</label>
                  <input type="date" id="logsTo" aria-label="Data final" />
                  <button id="btnExportLogs" class="btn-export" title="Exportar logs em Excel (.xlsx)">Exportar (.xlsx)</button>
                </div>
              </div>

              <div class="logs-body" id="logsBody" hidden>
                <div class="logs-table-wrap">
                  <table class="logs-table" aria-label="Últimos eventos">
                    <thead>
                      <tr>
                        <th scope="col">Data e hora</th>
                        <th scope="col">Plano</th>
                        <th scope="col">Etapa</th>
                        <th scope="col">Status</th>
                        <th scope="col">Mensagem</th>
                      </tr>
                    </thead>
                    <tbody id="tbodyLogs"></tbody>
                  </table>
                </div>
                <div class="logs-footer muted">Exibindo os eventos mais recentes. Novos eventos aparecem automaticamente.</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section id="tab-tratamento" style="display:none">
        <div class="treatment-controls">
          <div class="treatment-buttons">
            <button id="btnTratamentoSeed">Migrar planos</button>
            <button id="btnTratamentoIniciar" class="primary">Iniciar</button>
            <button id="btnTratamentoPausar">Pausar</button>
            <button id="btnTratamentoContinuar" disabled>Continuar</button>
            <span class="muted">Estado: <span id="tratamentoEstado">Ocioso</span></span>
          </div>
          <div class="treatment-export" role="group" aria-label="Exportar rescindidos por período">
            <label class="muted" for="inputRescindidosFrom">De:</label>
            <input type="date" id="inputRescindidosFrom" aria-label="Data inicial de rescisão" />
            <label class="muted" for="inputRescindidosTo">Até:</label>
            <input type="date" id="inputRescindidosTo" aria-label="Data final de rescisão" />
            <button id="btnDownloadRescindidos" class="btn-link">Exportar Rescindidos_CNPJ.txt</button>
          </div>
        </div>
        <div class="treatment-grid">
          <div class="treatment-column queue-column" aria-live="polite">
            <h3>PLANO EM EXECUÇÃO</h3>
            <div class="treatment-queue-content">
              <div id="treatmentQueuePanel" class="treatment-queue-panel">
                <div class="treatment-queue-scroll" role="region" aria-label="Plano em execução">
                  <table id="treatmentQueueTable" aria-label="Plano em execução">
                    <thead>
                      <tr>
                        <th scope="col">PLANO</th>
                        <th scope="col">CNPJ</th>
                        <th scope="col">RAZÃO SOCIAL</th>
                        <th scope="col">STATUS</th>
                        <th scope="col">ETAPA ATUAL</th>
                      </tr>
                    </thead>
                    <tbody id="tbodyTratamentoFila"></tbody>
                  </table>
                  <div id="tratamentoEmpty" class="treatment-empty" hidden>Nenhum plano em execução no momento.</div>
                </div>
              </div>
              <aside
                id="treatmentRescindidosPanel"
                class="treatment-rescindidos"
                aria-live="polite"
              >
                <div class="rescindidos-metrics">
                  <div class="rescindidos-metric queue">
                    <span class="rescindidos-label">Planos na fila</span>
                    <span class="rescindidos-value" id="treatmentQueueCount">0</span>
                  </div>
                  <div class="rescindidos-metric rescindidos">
                    <span class="rescindidos-label">Rescindidos</span>
                    <span class="rescindidos-value" id="treatmentRescindidosCount">0</span>
                  </div>
                  <div class="rescindidos-metric remaining" id="treatmentRescindidosRemaining" hidden>
                    <span class="rescindidos-label">Falta</span>
                    <span class="rescindidos-value" id="treatmentRescindidosRemainingValue">0</span>
                  </div>
                </div>
              </aside>
            </div>
          </div>

          <div class="treatment-column" aria-live="polite">
            <div class="treatment-card-header">
              <h3>TABELA DE PLANOS</h3>
              <label class="sr-only" for="treatmentSearch">Buscar planos</label>
              <input
                type="search"
                id="treatmentSearch"
                class="table-search-input"
                placeholder="Digite o número do plano, CNPJ ou razão social…"
                autocomplete="off"
              />
            </div>
            <div class="treatment-table-scroll" role="region" aria-label="Tabela de planos do tratamento">
              <table id="treatmentPlansTable" aria-label="Planos do tratamento">
                <thead>
                  <tr>
                    <th scope="col">PLANO</th>
                    <th scope="col">CNPJ</th>
                    <th scope="col">RAZÃO SOCIAL</th>
                    <th scope="col">TIPO</th>
                    <th scope="col">SITUAÇÃO</th>
                    <th scope="col">DT SITUAÇÃO</th>
                    <th scope="col">AÇÕES</th>
                  </tr>
                </thead>
                <tbody id="tbodyTratamentoTabela"></tbody>
              </table>
            </div>
            <div class="treatment-table-footer">
              <div class="muted" id="treatmentTableInfo" hidden></div>
              <div>
                <button id="btnTreatmentTablePrev" aria-label="Página anterior" title="Página anterior">&lt;</button>
                <span class="muted" id="treatmentTablePageLabel" style="margin:0 6px">pág. 1 de 1</span>
                <button id="btnTreatmentTableNext" aria-label="Próxima página" title="Próxima página">&gt;</button>
              </div>
            </div>
          </div>
        </div>
        <div id="treatmentLogsCard" class="treatment-logs card logs-card" aria-live="polite">
          <div
            class="logs-header"
            id="treatmentLogsHeader"
            role="button"
            tabindex="0"
            aria-expanded="false"
            aria-controls="treatmentLogsBody"
            title="Mostrar ou ocultar a janela de eventos do tratamento"
          >
            <div class="logs-title">
              <span class="caret" aria-hidden="true">▶</span>
              <strong>Janela de Eventos (log)</strong>
            </div>

            <div class="logs-actions">
              <label class="muted" for="treatmentLogsFrom">De:</label>
              <input type="date" id="treatmentLogsFrom" aria-label="Data inicial dos eventos de tratamento" />
              <label class="muted" for="treatmentLogsTo">Até:</label>
              <input type="date" id="treatmentLogsTo" aria-label="Data final dos eventos de tratamento" />
              <button id="btnTreatmentExportLogs" class="btn-export" title="Exportar logs de tratamento em Excel (.xlsx)">
                Exportar (.xlsx)
              </button>
            </div>
          </div>

          <div class="logs-body" id="treatmentLogsBody" hidden>
            <div class="logs-table-wrap" id="treatmentLogsWrap">
              <table class="logs-table" aria-label="Eventos de tratamento">
                <thead>
                  <tr>
                    <th scope="col">Data e hora</th>
                    <th scope="col">Plano</th>
                    <th scope="col">Etapa</th>
                    <th scope="col">Status</th>
                    <th scope="col">Mensagem</th>
                  </tr>
                </thead>
                <tbody id="tbodyTratamentoLogs"></tbody>
              </table>
            </div>
            <div class="logs-footer muted">
              Exibindo os eventos de tratamento mais recentes. Role para consultar os anteriores.
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>
</main>

<footer class="page-footer" aria-label="Informações de desenvolvimento">
  <p>Desenvolvido por:</p>
  <p>CEFGD/RJ – Recuperação de Débitos do FGTS Perante o Empregador</p>
  <p>CAIXA™ - 2025</p>
</footer>

<script src="js/utils.js"></script>
<script src="js/dom.js"></script>
<script src="js/logs.js"></script>
<script src="js/gestao.js"></script>
<script src="js/tratamento.js"></script>
<script src="js/app.js"></script>
</body>
</html>
